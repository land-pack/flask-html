<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/500.com/flask-html/bg2manager/templates/send.html</title>
<meta name="Generator" content="Vim/8.0">
<meta name="plugin-version" content="vim7.4_v2">
<meta name="syntax" content="none">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="none">
<style type="text/css">
<!--
-->
table
{
  border-collapse:collapse;
  width:80%;
}

tr, td {
    text-align:center;
}

table ,tr, th
  {
  border:1px solid black;
  }

button { 
    background-color: #4CAF50; /* Green */ 
    border: none; 
    color: white; 
    padding: 15px 32px; 
    text-align: center; 
    text-decoration: none; 
    display: inline-block; 
    font-size: 16px; 
}

select option{
    margin: 20px;
    background: rgba(0, 0, 0, 0.3);
    color: #fff;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.4);
}

label {

    font-size: 19px;

}
.upload_button {
    margin: 5px;
    font-size: 19px;


}

.oneline {
    white-space: nowrap;

}

</style>



<script type='text/javascript'>
<!--

-->
function addRow(){
    var table = document.getElementById('mytable');
    var row = table.insertRow(0);
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    var cell1_content = document.getElementById("cell1").innerHTML;
    var cell2_content = document.getElementById("cell2").innerHTML;
    var cell3_content = document.getElementById("cell3").innerHTML;
    cell1.innerHTML = "<td>优惠券:" + cell1_content + "</td";
    cell2.innerHTML = "<td>有效期:" + cell2_content + "</td";
    cell3.innerHTML = "<td>文案:" + cell3_content + "</td";
}


function sendPrize(){
    var table = document.getElementById('mytable');
    //var select_obj = document.getElementById("mytable").rows[0].cells[0];
    var select_obj = document.getElementById("cell1");
    var select_value = select_obj.options[select_obj.selectedIndex].value;
    console.log(select_value);
}


function parserTable(){
    var t=document.getElementById("mytable");
    var row = '';
    var tr = '';
    var c1 = '';

    for (i=0; i <t.rows.length; i++){
        console.log("hello ..");
        row = t.rows[i];
        //tr = row.getElementsByTagName("tr");
        c1 = row.getElementsByTagName("td")
        console.log(c1);

        // var tr = t.getElementsByTagName("tr");
        // var s=tr[1];
        // tr[0].querySelector("select").value

    }

}

function post(url, params)
{
    // post data by self post function
    // @param url: destination url
    // @param params: a dict-type
    
    var temp = document.createElement("form");
    temp.action = url;
    temp.method = "post";
    temp.style.display = "none";
    for (var x in params){
        var opt = document.createElement("textarea");
        opt.name = x;
        opt.value = params[x];
        temp.appendChild(opt);
        }
   document.body.appendChild(temp);
   temp.submit();
   return temp;
}

function readTable(){

    var a =new  Array();
    var trDom = document.querySelectorAll( 'tbody tr' );
    for( var i=0;i<trDom.length;i++ ){
	    console.log( trDom[i] );
	    var c = trDom[i].getElementsByClassName('c1');
	    console.log(c[0].value);
	    var c2 = trDom[i].getElementsByClassName('c2');
	    console.log( c2[0].value );
	    var c3 = trDom[i].getElementsByClassName('c3');
	    console.log( c3[0].value );
        if(c[0].value && c2[0].value && c3[0].value){
            a[i] = {
                "type":c[0].value,
                "date":c2[0].value,
                "content": c3[0].value
            };
        }
    }

    console.log(a);
    return a;

}

function submit_mycode(){
    var arr = readTable();
    ajax({
            type: "POST",
            url: "/send",
            data: JSON.stringify(arr),
            dataType: 'json'
    
    })
    //post("/send", {"data": arr});
    console.log("upload success");

}

/// new function 
var createAjax = function () {
    var xhr = null;
    try {
        xhr = new ActiveXObject("microsoft.xmlhttp");
    } catch (e1) {
        try {
            xhr = new XMLHttpRequest();
        } catch (e2) {
            window.alert("您的浏览器不支持ajax，请更换！");
        }
    }
    return xhr;
};
var ajax = function (conf) {
    var type = conf.type;
    var url = conf.url;
    var data = conf.data;
    var dataType = conf.dataType;
    var success = conf.success;
    if (type == null) {
        type = "get";
    }
    if (dataType == null) {
        dataType = "text";
    }
    var xhr = createAjax();
    xhr.open(type, url, true);
    if (type == "GET" || type == "get") {
        xhr.send(null);
    } else if (type == "POST" || type == "post") {
        xhr.setRequestHeader("content-type",
            "application/x-www-form-urlencoded");
        xhr.send(data);
    }
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
            if (dataType == "text" || dataType == "TEXT") {
                if (success != null) {
                    success(xhr.responseText);
                }
            } else if (dataType == "xml" || dataType == "XML") {
                if (success != null) {
                    success(xhr.responseXML);
                }
            } else if (dataType == "json" || dataType == "JSON") {
                if (success != null) {
                    success(eval("(" + xhr.responseText + ")"));
                }
            }
        } else if (xhr.readyState == 4 && xhr.status != 200) {
            //alert("请求失败!");
        }
    };
};




</script>
</head>
<body>
<h2>选择优惠券</h2>
<hr>
<div>
    <table id="mytable" class="aa">
        <tr style="display:none" class="aaa">
            <td class="c1">cell1</td>
            <td class="c2">cell2</td>
            <td class="c3">cell3</td>
       </tr>
    </table>
</div>
<br>
<button onclick="addRow()">+添加</button>

<h2>选择派发用户</h2>
<hr>

<div id="part2">

  <form action="">
    <label for="send_target" class="oneline">派发方式</label>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    批量派发<input type="radio" name="send_target" value="multi" id="send_target" class="oneline">
    单个派发<input type="radio" name="send_target" value="one" id="send_target" class="oneline">
    <!-- 用户选择 -->
    <br>
    <label for="send_target" class="oneline">用户ID</label>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <input type="button" name="send_target" value="导入名单" id="send_target" class="upload_button">
    <input type="button" name="send_target" value="用户ID" id="send_target" class="upload_button">
    <br>
    <label for="send_target" class="oneline">PUSH通知</label>
    <br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    标题   <input type="text" name="title"><br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    内容   <input type="text" name="content" placeholder="不能超过17个字"><br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    链接   <input type="text" name="link" placeholder="默认到背包"><br>
</form>
</div>

<hr>
<button onclick="sendPrize()">确认派发</button>
<!--all template below -->
<div id="cell1" style="display:none">
        <select id="mySelect" class="c1">
              {% for i in wel_select %}
              <option  value="{{ i.get('_id') }} ">{{ i.get("prize_name") }}</option>
              {% endfor %}
        </select>
</div>

<div id="cell2" style="display:none">
        <input type="date" name="user_date" class="c2" />
</div>

<div id="cell3" style="display:none">
        <input type="text" name="content" class="c3">
</div>

</body>
</html>
<!-- vim: set foldmethod=manual : -->
